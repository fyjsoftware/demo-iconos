<!DOCTYPE html>

<html>
  <head>
    <style>
      html * {
        font-family: "Verdana", cursive, sans-serif;
      }

      h3,
      .datos {
        display: inline;
      }
    </style>
    <script>
      document.addEventListener("DOMContentLoaded", function (event) {
        const url = new URL(document.getElementById("datos").src);

        document.getElementById("desarrollador").addEventListener("input", (event) => {
          url.searchParams.delete("desarrollador");
          url.searchParams.append("desarrollador", event.target.value);
          document.getElementById("datos").src = url;
      	});

        document.getElementById("cliente").addEventListener("input", (event) => {
          url.searchParams.delete("cliente");
          url.searchParams.append("cliente", event.target.value);
          document.getElementById("datos").src = url;
      	});

        document.getElementById("filtro").addEventListener("click", (event) => {
          url.searchParams.delete("filtro");
          if (event.target.checked) url.searchParams.append("filtro", "true");
          else url.searchParams.append("filtro", "false");
          document.getElementById("datos").src = url;
      	});

        let devs = <%- listas.devs %>;
        let clientes = <%- listas.clientes %>;

        for (let i = 0; i < devs.length; i++) {
            document.getElementById("desarrolladores").innerHTML += "<option value=\"" + devs[i] + "\"></option>"
        }

        for (let i = 0; i < clientes.length; i++) {
            document.getElementById("clientes").innerHTML += "<option value=\"" + clientes[i] + "\"></option>"
        }
      });


      function compartir() {
      	window.prompt(
      		"Por favor, copie el siguiente enlace para compartir su reporte de tiempo.",
      		window.location.href.split(/[?#]/)[0]
      	);
      }
      function eliminar() {
      	if (
      		window.confirm(
      			"¿Está seguro que desea eliminar su reporte? Esta acción es irreversible."
      		)
      	) {
      		window.location =
      			window.location.origin +
      			"/delete/" +
      			window.location.pathname.split("/")[1];
      	}
      }
    </script>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <title>Proyecto ICONOS</title>
  </head>

  <body>
    <h3>Proyecto ICONOS</h3>
    <small>Reporte a consultar:
      <div class="datos" id="tabla"><%- tabla %></div></small>
    <a href="/"><button>Volver al inicio</button></a><br /><br />
    <div>
      Filtrar por desarrollador
      <input
        id="desarrollador"
        name="desarrollador"
        list="desarrolladores"
        placeholder="Escriba aquí"
      />
      <datalist id="desarrolladores"> </datalist>
      Filtrar por cliente
      <input
        id="cliente"
        name="cliente"
        list="clientes"
        placeholder="Escriba aquí"
      />
      <datalist id="clientes"> </datalist>
      </a>
      <input type="checkbox" id="filtro" name="filtro" />
      Filtrar duración total de desarrolladores
    </div>
    <br />
    <div id="tabla">
      <iframe id="datos" width="900" height="500" src="/show/<%- tabla %>"></iframe>
    </div>
    <br />
    <button onclick="compartir()">Compartir</button>
    <button onclick="eliminar()">Eliminar</button></a>
  </body>
</html>
